#!/usr/bin/env bash

set -euEo pipefail
shopt -s dotglob

cd "$PKG_CONTENT"

while read -r file; do
  rel_file_path="${file#./}"
  file="${rel_file_path##*/}"
  rel_base_path="${rel_file_path%/*}"

  if [[ "$rel_file_path" != "$file" && ! -d ~/"$rel_base_path" ]]; then
    mkdir --parents --verbose ~/"$rel_base_path"
  fi
  ln --symbolic --force --verbose "${PKG_CONTENT}/${rel_file_path}" ~/"${rel_file_path}"
done < <(find . -type f)

