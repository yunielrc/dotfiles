#!/usr/bin/env bash

set -euEo pipefail

# Dependencies
sudo apt-get update -y
sudo apt-get install -y fonts-firacode \
                        dconf-service \
                        dconf-cli network-manager

# Install

# Applications without installation script that have personalized configuration in the home
sudo apt-get install -y gpg \
                        neofetch \
                        htop

# OpenVPN Gnome plugin
sudo apt-get install -y network-manager-openvpn-gnome openvpn-systemd-resolved
sudo systemctl restart network-manager

# Gnome Extension dependencies
sudo apt-get install -y chrome-gnome-shell

## Sensory Perception
sudo apt-get install -y lm-sensors

## Text Translator
sudo apt-get install -y gir1.2-clutter-1.0 \
                        gir1.2-clutter-gst-3.0 \
                        gir1.2-gtkclutter-1.0
(
  cd /usr/bin
  sudo wget https://git.io/trans
  sudo chmod a+x trans
)

## nautilus gpg integration
sudo apt-get install -y seahorse-nautilus

# Config

## GNOME Extension & Apps
envsubst < "${PKG_PATH}/org.gnome.dconf.ini" | dconf load /org/gnome/

## Network
### Import OpenVPN profiles
for vpn in "${PKG_PATH}/ovpn-profiles"/*.ovpn; do
  [[ -f "$vpn" ]] || continue
  nmcli connection import type openvpn file "$vpn" \
  || sudo nmcli connection import type openvpn file "$vpn"
done
