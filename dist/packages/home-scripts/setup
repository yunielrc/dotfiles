#!/usr/bin/env bash

set -euEo pipefail

sudo apt-get update -y

# NETCONN-TOGGLE

# Idempotent
if [[ ! -f ~/.usr/bin/netconn-toggle ]]; then
  ## add keybindings
  bl::gnome_add_custom_keybinding 'Toggle ethernet' \
                                  "bash -c 'netconn-toggle ${NETCONN_TOGGLE_USB_ETHERNET_CONN}'" \
                                  "$NETCONN_TOGGLE_USB_ETHERNET_KEYBIND"
  bl::gnome_add_custom_keybinding 'Toggle vpn' \
                                  "bash -c 'netconn-toggle ${NETCONN_TOGGLE_VPN_CONN}'" \
                                  "$NETCONN_TOGGLE_VPN_KEYBIND"
  bl::gnome_add_custom_keybinding 'Toggle wifi 2.4' \
                                  "bash -c 'netconn-toggle ${NETCONN_TOGGLE_WIFI2_CONN}'" \
                                  "$NETCONN_TOGGLE_WIFI2_KEYBIND"
  bl::gnome_add_custom_keybinding 'Toggle wifi 5' \
                                  "bash -c 'netconn-toggle ${NETCONN_TOGGLE_WIFI5_CONN}'" \
                                  "$NETCONN_TOGGLE_WIFI5_KEYBIND"
fi
# :NETCONN-TOGGLE

# GPG-BACKUP

## Dependencies
sudo apt-get install -y gpg
# :GPG-BACKUP

# RSYNC-BACKUP

## Dependencies
sudo apt-get install -y rsync
## Config
### allows rsync-backup to mount an nfs device
# https://www.digitalocean.com/community/tutorials/how-to-edit-the-sudoers-file-on-ubuntu-and-centos
echo "${USER} ALL=NOPASSWD:$(type -P mount)" | sudo tee "/etc/sudoers.d/${USER}-nopasswd-mount"

### allows run rsync-backup daily
cat <<EOF | sudo tee "/etc/cron.daily/${USER}-rsync-backup"
#!/usr/bin/env sh
sudo --user=${USER} bash -c "${HOME_BIN}/rsync-backup backup"
EOF
sudo chmod +x "/etc/cron.daily/${USER}-rsync-backup"
# :RSYNC-BACKUP


