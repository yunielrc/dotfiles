#!/usr/bin/env bash

set -euEo pipefail

[[ -f ~/.local/bin/backup-home ]] && {
  echo 'backup-home currently installed'
  exit 0
}

# Install dependencies
sudo apt-get update -y
sudo apt-get install -y rsync nfs-common || :

# Install

cat <<EOF | sudo tee "/etc/cron.daily/backup-home-${USER}"
#!/usr/bin/env sh
sudo --user=${USER} bash -c "$(realpath ~)/.local/bin/backup-home backup"
EOF

sudo chmod +x "/etc/cron.daily/backup-home-${USER}"
