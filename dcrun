#!/bin/bash

set -euoE pipefail

readonly SCRIPT="$(basename "$0")"

set -o allexport
. ./.env
set +o allexport

readonly service="$1"

if [[ "$service" == build-* ]]; then
    docker-compose build
fi

shift
docker-compose run --rm \
-v "$(readlink -f ./.env):${DOCKER_MOUNT}/.env" \
-v "$(readlink -f ./.env.override.server):${DOCKER_MOUNT}/.env.override.server" \
-v "$(readlink -f ./dist/.env):${DOCKER_MOUNT}/dist/.env" \
-v "$(readlink -f ./dist/.env.override.server):${DOCKER_MOUNT}/dist/.env.override.server" \
"$service" "$@"

